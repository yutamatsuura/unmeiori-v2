<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P-002 é‘‘å®šæ›¸ä½œæˆãƒšãƒ¼ã‚¸ - sindankantei</title>
    
    <!-- MUI v5 CDN -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@mui/material@5.14.0/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ  ã‚«ã‚¹ã‚¿ãƒ CSS */
        :root {
            --primary-color: #34495e;
            --secondary-color: #bdc3c7;
            --accent-color: #16a085;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --shadow: 0 2px 8px rgba(52, 73, 94, 0.1);
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans JP', 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #2c3e50 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .form-section, .preview-section {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            height: fit-content;
        }
        
        .section-title {
            color: var(--primary-color);
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .preview-card {
            border: 2px dashed var(--secondary-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            background: #fafbfc;
        }
        
        .result-section {
            background: var(--surface-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent-color);
        }
        
        .calculation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .calculation-item {
            background: var(--background-color);
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, var(--accent-color) 0%, #138d75 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 160, 133, 0.3);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .success-message {
            color: var(--success-color);
            background: rgba(39, 174, 96, 0.1);
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // MaterialUIãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
        const MaterialUI = window.MaterialUI || {};
        
        const { 
            ThemeProvider, 
            createTheme, 
            CssBaseline,
            AppBar,
            Toolbar,
            Typography,
            Container,
            Grid,
            Paper,
            TextField,
            Button,
            Box,
            Card,
            CardContent,
            FormControl,
            InputLabel,
            Select,
            MenuItem,
            Chip,
            LinearProgress,
            CircularProgress,
            Alert,
            Divider,
            Icon
        } = MaterialUI;

        // ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒ
        const theme = createTheme({
            palette: {
                primary: {
                    main: '#34495e',
                    contrastText: '#ffffff'
                },
                secondary: {
                    main: '#bdc3c7'
                },
                success: {
                    main: '#16a085'
                },
                background: {
                    default: '#f8f9fa',
                    paper: '#ffffff'
                }
            },
            typography: {
                fontFamily: '"Noto Sans JP", "Roboto", sans-serif'
            }
        });

        const KanteiCreatePage = () => {
            // ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
            const [formData, setFormData] = React.useState({
                name: '',
                birthDate: '',
                birthTime: '',
                gender: '',
                birthPlace: '',
                email: ''
            });
            
            const [errors, setErrors] = React.useState({});
            const [isCalculating, setIsCalculating] = React.useState(false);
            const [calculationResult, setCalculationResult] = React.useState(null);
            const [showSuccess, setShowSuccess] = React.useState(false);

            // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒãƒ³ãƒ‰ãƒ©
            const handleInputChange = (field) => (event) => {
                const value = event.target.value;
                setFormData(prev => ({ ...prev, [field]: value }));
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                if (errors[field]) {
                    setErrors(prev => ({ ...prev, [field]: '' }));
                }
            };

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const validateForm = () => {
                const newErrors = {};
                
                if (!formData.name.trim()) newErrors.name = 'æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                if (!formData.birthDate) newErrors.birthDate = 'ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                if (!formData.gender) newErrors.gender = 'æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„';
                if (!formData.email.trim()) newErrors.email = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
                
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            // é‘‘å®šè¨ˆç®—å®Ÿè¡Œ
            const handleCalculate = async () => {
                if (!validateForm()) return;
                
                setIsCalculating(true);
                
                try {
                    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: å®Ÿéš›ã®APIå‘¼ã³å‡ºã—
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // ãƒ¢ãƒƒã‚¯çµæœãƒ‡ãƒ¼ã‚¿
                    const mockResult = {
                        kyuseiKigaku: {
                            honmei: 'ä¸ƒèµ¤é‡‘æ˜Ÿ',
                            gekkyu: 'ä¸‰ç¢§æœ¨æ˜Ÿ',
                            nichikyu: 'ä¹ç´«ç«æ˜Ÿ',
                            seikaku: 'ç¤¾äº¤æ€§ã«å„ªã‚Œã€è¯ã‚„ã‹ãªé­…åŠ›ã‚’æŒã¤äººã§ã™ã€‚'
                        },
                        seimeiHandan: {
                            soukaku: 32,
                            tenkaku: 18,
                            jinkaku: 24,
                            chikaku: 14,
                            gaikaku: 8,
                            hyoka: 'å¤§å‰ - éå¸¸ã«è‰¯ã„é‹å‹¢ã‚’æŒã¤åå‰ã§ã™ã€‚'
                        },
                        kichihoui: {
                            honnen: 'æ±',
                            gekkan: 'å—æ±',
                            suishin: 'æ—…è¡Œã‚„å¼•è¶Šã—ã«æœ€é©ãªæ™‚æœŸã§ã™ã€‚'
                        }
                    };
                    
                    setCalculationResult(mockResult);
                    setShowSuccess(true);
                    
                    setTimeout(() => setShowSuccess(false), 5000);
                    
                } catch (error) {
                    console.error('è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                } finally {
                    setIsCalculating(false);
                }
            };

            // PDFç”Ÿæˆ
            const handleGeneratePDF = () => {
                console.log('PDFç”Ÿæˆå‡¦ç†é–‹å§‹');
                // å®Ÿéš›ã®PDFç”ŸæˆAPIå‘¼ã³å‡ºã—
            };

            return (
                <ThemeProvider theme={theme}>
                    <CssBaseline />
                    <div className="app-container">
                        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                        <div className="header">
                            <Typography variant="h4" component="h1" sx={{ fontWeight: 600 }}>
                                ğŸŒŸ é‘‘å®šæ›¸ä½œæˆãƒšãƒ¼ã‚¸
                            </Typography>
                            <Typography variant="subtitle1" sx={{ opacity: 0.9, mt: 0.5 }}>
                                ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ã‚’å…¥åŠ›ã—ã¦çµ±åˆé‘‘å®šæ›¸ã‚’1åˆ†ã§ç”Ÿæˆ
                            </Typography>
                        </div>

                        {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                        <div className="main-content">
                            {/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                            <div className="form-section">
                                <div className="section-title">
                                    <Icon>person_add</Icon>
                                    ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±å…¥åŠ›
                                </div>
                                
                                {showSuccess && (
                                    <Alert severity="success" sx={{ mb: 2 }}>
                                        é‘‘å®šè¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸï¼çµæœã‚’ã”ç¢ºèªãã ã•ã„ã€‚
                                    </Alert>
                                )}

                                <div className="form-group">
                                    <TextField
                                        fullWidth
                                        label="æ°å"
                                        value={formData.name}
                                        onChange={handleInputChange('name')}
                                        error={!!errors.name}
                                        helperText={errors.name}
                                        variant="outlined"
                                        required
                                    />
                                </div>

                                <div className="form-row">
                                    <TextField
                                        fullWidth
                                        label="ç”Ÿå¹´æœˆæ—¥"
                                        type="date"
                                        value={formData.birthDate}
                                        onChange={handleInputChange('birthDate')}
                                        error={!!errors.birthDate}
                                        helperText={errors.birthDate}
                                        InputLabelProps={{ shrink: true }}
                                        required
                                    />
                                    
                                    <TextField
                                        fullWidth
                                        label="ç”Ÿã¾ã‚Œæ™‚é–“ï¼ˆä»»æ„ï¼‰"
                                        type="time"
                                        value={formData.birthTime}
                                        onChange={handleInputChange('birthTime')}
                                        InputLabelProps={{ shrink: true }}
                                    />
                                </div>

                                <div className="form-row">
                                    <FormControl fullWidth error={!!errors.gender} required>
                                        <InputLabel>æ€§åˆ¥</InputLabel>
                                        <Select
                                            value={formData.gender}
                                            onChange={handleInputChange('gender')}
                                            label="æ€§åˆ¥"
                                        >
                                            <MenuItem value="male">ç”·æ€§</MenuItem>
                                            <MenuItem value="female">å¥³æ€§</MenuItem>
                                        </Select>
                                        {errors.gender && <div className="error-message">{errors.gender}</div>}
                                    </FormControl>
                                    
                                    <TextField
                                        fullWidth
                                        label="å‡ºç”Ÿåœ°ï¼ˆä»»æ„ï¼‰"
                                        value={formData.birthPlace}
                                        onChange={handleInputChange('birthPlace')}
                                        variant="outlined"
                                    />
                                </div>

                                <div className="form-group">
                                    <TextField
                                        fullWidth
                                        label="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                                        type="email"
                                        value={formData.email}
                                        onChange={handleInputChange('email')}
                                        error={!!errors.email}
                                        helperText={errors.email}
                                        variant="outlined"
                                        required
                                    />
                                </div>

                                <Button
                                    className="generate-btn"
                                    onClick={handleCalculate}
                                    disabled={isCalculating}
                                    startIcon={isCalculating ? <CircularProgress size={20} /> : <Icon>calculate</Icon>}
                                >
                                    {isCalculating ? 'è¨ˆç®—ä¸­...' : 'é‘‘å®šè¨ˆç®—å®Ÿè¡Œ'}
                                </Button>
                            </div>

                            {/* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                            <div className="preview-section" style={{ position: 'relative' }}>
                                <div className="section-title">
                                    <Icon>preview</Icon>
                                    é‘‘å®šçµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                                </div>

                                {isCalculating && (
                                    <div className="loading-overlay">
                                        <CircularProgress size={60} />
                                    </div>
                                )}

                                {!calculationResult ? (
                                    <div className="preview-card">
                                        <Icon sx={{ fontSize: 48, color: '#bdc3c7', mb: 2 }}>description</Icon>
                                        <Typography variant="h6" color="textSecondary">
                                            é‘‘å®šçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                                        </Typography>
                                        <Typography variant="body2" color="textSecondary" sx={{ mt: 1 }}>
                                            å·¦å´ã®ãƒ•ã‚©ãƒ¼ãƒ ã«æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€Œé‘‘å®šè¨ˆç®—å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
                                        </Typography>
                                    </div>
                                ) : (
                                    <>
                                        {/* ä¹æ˜Ÿæ°—å­¦çµæœ */}
                                        <div className="result-section">
                                            <Typography variant="h6" sx={{ mb: 1, color: '#34495e' }}>
                                                ğŸŒŸ ä¹æ˜Ÿæ°—å­¦
                                            </Typography>
                                            <div className="calculation-grid">
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">æœ¬å‘½æ˜Ÿ</Typography>
                                                    <Chip label={calculationResult.kyuseiKigaku.honmei} color="primary" />
                                                </div>
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">æœˆå‘½æ˜Ÿ</Typography>
                                                    <Chip label={calculationResult.kyuseiKigaku.gekkyu} color="secondary" />
                                                </div>
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">æ—¥å‘½æ˜Ÿ</Typography>
                                                    <Chip label={calculationResult.kyuseiKigaku.nichikyu} color="success" />
                                                </div>
                                            </div>
                                            <Typography variant="body2" sx={{ mt: 1 }}>
                                                {calculationResult.kyuseiKigaku.seikaku}
                                            </Typography>
                                        </div>

                                        {/* å§“ååˆ¤æ–­çµæœ */}
                                        <div className="result-section">
                                            <Typography variant="h6" sx={{ mb: 1, color: '#34495e' }}>
                                                ğŸ“ å§“ååˆ¤æ–­
                                            </Typography>
                                            <div className="calculation-grid">
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">ç·æ ¼</Typography>
                                                    <Typography variant="h6">{calculationResult.seimeiHandan.soukaku}</Typography>
                                                </div>
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">å¤©æ ¼</Typography>
                                                    <Typography variant="h6">{calculationResult.seimeiHandan.tenkaku}</Typography>
                                                </div>
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">äººæ ¼</Typography>
                                                    <Typography variant="h6">{calculationResult.seimeiHandan.jinkaku}</Typography>
                                                </div>
                                            </div>
                                            <Alert severity="success" sx={{ mt: 1 }}>
                                                {calculationResult.seimeiHandan.hyoka}
                                            </Alert>
                                        </div>

                                        {/* å‰æ–¹ä½çµæœ */}
                                        <div className="result-section">
                                            <Typography variant="h6" sx={{ mb: 1, color: '#34495e' }}>
                                                ğŸ§­ å‰æ–¹ä½
                                            </Typography>
                                            <div className="calculation-grid">
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">æœ¬å¹´</Typography>
                                                    <Chip label={calculationResult.kichihoui.honnen} color="primary" variant="outlined" />
                                                </div>
                                                <div className="calculation-item">
                                                    <Typography variant="subtitle2">æœˆé–“</Typography>
                                                    <Chip label={calculationResult.kichihoui.gekkan} color="secondary" variant="outlined" />
                                                </div>
                                            </div>
                                            <Typography variant="body2" sx={{ mt: 1 }}>
                                                {calculationResult.kichihoui.suishin}
                                            </Typography>
                                        </div>

                                        <Button
                                            variant="contained"
                                            color="success"
                                            onClick={handleGeneratePDF}
                                            startIcon={<Icon>picture_as_pdf</Icon>}
                                            sx={{ mt: 2, width: '100%' }}
                                        >
                                            PDFé‘‘å®šæ›¸ã‚’ç”Ÿæˆ
                                        </Button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </ThemeProvider>
            );
        };

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        ReactDOM.render(<KanteiCreatePage />, document.getElementById('root'));
    </script>

    <!--
    ã€CF_06å¼•ãç¶™ãæƒ…å ±ã€‘
    UIè¦ä»¶: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåŸºæœ¬æƒ…å ±å…¥åŠ›â†’ä¹æ˜Ÿæ°—å­¦ãƒ»å§“ååˆ¤æ–­è‡ªå‹•è¨ˆç®—â†’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼â†’PDFç”Ÿæˆ
    å¿…è¦API: 
      - POST /api/kantei/calculate (é‘‘å®šè¨ˆç®—å®Ÿè¡Œ)
      - GET /api/kantei/templates (81ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—)
      - POST /api/kantei/generate-pdf (PDFé‘‘å®šæ›¸ç”Ÿæˆ)
    å…¥åŠ›ãƒ‡ãƒ¼ã‚¿: {
      name: string,
      birth_date: date,
      birth_time?: string,
      gender: "male"|"female",
      birth_place?: string,
      email: string
    }
    å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿: {
      kyusei_kigaku: { honmei: string, gekkyu: string, nichikyu: string, seikaku: string },
      seimei_handan: { soukaku: number, tenkaku: number, jinkaku: number, chikaku: number, gaikaku: number, hyoka: string },
      kichihoui: { honnen: string, gekkan: string, suishin: string },
      template_ids: number[]
    }
    UIæ–‡è„ˆ: å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ â†’è¨ˆç®—å®Ÿè¡Œâ†’çµæœè¡¨ç¤ºâ†’PDFç”Ÿæˆâ†’æ¬¡ãƒšãƒ¼ã‚¸ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»é€ä¿¡ï¼‰ã¸ã®é·ç§»
    ç‰¹è¨˜äº‹é …: 
      - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ
      - è¨ˆç®—ä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      - ä¹æ˜Ÿæ°—å­¦ãƒ»å§“ååˆ¤æ–­ã®è¤‡é›‘ãªè¨ˆç®—å‡¦ç†
      - 81ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®éåŒæœŸå–å¾—
      - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆè¨ˆç®—å¤±æ•—æ™‚ã®è¡¨ç¤ºï¼‰
    -->
</body>
</html>