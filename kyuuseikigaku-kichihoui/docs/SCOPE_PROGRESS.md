# kyuuseikigaku-kichihoui 開発進捗状況

## 🎯 現在の開発タスク: 九星気学鑑定書PDF出力システム

### 📅 作成日: 2025-09-22

### プロジェクト概要
既存の九星気学吉方位システムから核心ロジックを抽出し、PDF/Word形式の鑑定書を生成できる軽量なシステムを構築する。

### 主要機能
1. 生年月日入力による九星計算
2. 編集可能な鑑定書プレビュー
3. PDF形式でのダウンロード機能
4. （将来）時刻要素の追加（オプション）

---

## 📊 調査結果サマリー

### 既存システム技術スタック
- **フロントエンド**: TypeScript + Vue.js 2.x + D3.js
- **描画**: SVG + D3.js
- **ビルド**: Webpack
- **総コード量**: 5,064行（TypeScript）

### 九星気学ロジックの複雑度評価
- **複雑度**: 高度に複雑
- **吉凶判定**: 21種類（吉方位9種、凶方位12種）
- **計算層**: 年盤・月盤・日盤の3層構造
- **特殊処理**: 節入り、土用、五行相生相克

### ロジック抽出可能性
- **結論**: ✅ 100%同じ結果を保証可能
- **理由**:
  - 純粋な数学計算のみ（外部依存なし）
  - UI層とビジネスロジックが完全分離
  - 決定的アルゴリズム（ランダム要素なし）

---

## 📝 実装方法の選定

### 検討した選択肢

| 方法 | 工数 | メリット | デメリット | 評価 |
|------|------|---------|-----------|------|
| A. ロジック抽出+新規プロジェクト | 3-5日 | 軽量、高速、柔軟 | ロジック重複管理 | ⭐推奨 |
| B. 既存システムにPDF追加 | 2-3日 | 最短、一元管理 | システムが重い | △ |
| C. デモ版（ダミーデータ） | 1日 | 即座に完成 | 計算が不正確 | ✗ |

### 選定結果
**方法A（ロジック抽出+新規プロジェクト）を採用**

---

## 🔧 必要なロジックファイル

### 最小構成（9ファイル）
```
1. src/js/bans/qseis/Qsei.ts          # 九星計算の核心
2. src/js/bans/dates/QseiDate.ts      # 九星暦変換
3. src/js/bans/units/Setu.ts          # 節入り計算
4. src/js/bans/units/Gogyou.ts        # 五行定義
5. src/js/bans/units/Houi.ts          # 方位定義
6. src/js/bans/units/Hakka.ts         # 八卦定義
7. src/js/times/LocalDate.ts          # 日付処理
8. src/js/times/ChronoUnit.ts         # 時間計算
9. src/js/utils/TypeUtils.ts          # 型変換
```

### 吉凶判定追加時（+6ファイル）
```
10. src/js/bans/units/Kipou.ts        # 吉凶判定ロジック
11. src/js/bans/units/JikanEto.ts     # 時間干支
12. src/js/bans/units/Eto.ts          # 干支定義
13. src/js/bans/units/Sangou.ts       # 三合
14. src/js/bans/qseis/QseiGroupBase.ts # 九星グループ
15. src/js/bans/qseis/BirthdayQseiGroup.ts # 生年月日九星
```

---

## 🚀 実装計画

### フェーズ1: プロジェクト基盤構築（Day 1）
- [ ] 新規プロジェクトの作成
- [ ] TypeScript環境のセットアップ
- [ ] 必要なパッケージのインストール（jsPDF等）

### フェーズ2: ロジック移植（Day 1-2）
- [ ] 9つの核心ファイルをコピー
- [ ] 依存関係の解決
- [ ] 単体テストの作成
- [ ] 計算結果の検証（既存システムと比較）

### フェーズ3: UI実装（Day 2-3）
- [ ] 入力フォーム作成（生年月日、性別）
- [ ] 鑑定書テンプレート作成
- [ ] 方位盤のSVG描画実装
- [ ] レスポンシブデザイン対応

### フェーズ4: 編集機能（Day 3-4）
- [ ] contentEditableによる編集機能
- [ ] 編集内容の保存・復元
- [ ] プレビューモード切替

### フェーズ5: PDF出力（Day 4-5）
- [ ] jsPDFの統合
- [ ] html2canvasによる描画キャプチャ
- [ ] PDFレイアウト調整
- [ ] ダウンロード機能実装

### フェーズ6: テスト・調整（Day 5）
- [ ] E2Eテスト
- [ ] 複数ブラウザでの動作確認
- [ ] パフォーマンス最適化

---

## 💰 見積もり情報

### PDF/Word機能追加
- **工数**: 2-3日
- **難易度**: 中程度
- **推定費用**: 10-15万円（フリーランス相場）

### 時刻要素追加（将来拡張）
- **工数**: 48時間（6人日）
- **開発期間**: 3週間
- **難易度**: 中程度
- **推定費用**: 35-45万円

#### 時刻要素の詳細内訳
1. 基盤クラス開発: 16時間
2. 統合クラス開発: 12時間
3. UI実装: 16時間
4. テスト・調整: 4時間

---

## 🎯 成功の判定基準

### 必須要件
- ✅ 生年月日から正確な九星を計算
- ✅ 年盤・月盤・日盤の表示
- ✅ 吉凶方位の正確な判定
- ✅ PDF形式でのダウンロード

### 品質基準
- ✅ 既存システムと100%同じ計算結果
- ✅ モバイル端末でも使用可能
- ✅ 3秒以内でPDF生成
- ✅ 編集内容がPDFに反映

---

## 📊 リスクと対策

| リスク | 可能性 | 影響 | 対策 |
|--------|--------|------|------|
| ロジック移植時のバグ | 低 | 高 | 徹底的な単体テスト実施 |
| PDF生成の文字化け | 中 | 中 | 日本語フォント埋め込み |
| ブラウザ互換性 | 低 | 低 | Polyfill使用 |
| 計算精度の差異 | 低 | 高 | 境界値テスト実施 |

---

## 🔄 進捗状況

### 現在のステータス: **計画段階**

| タスク | ステータス | 更新日時 |
|--------|----------|---------|
| 調査・分析 | ✅ 完了 | 2025-09-22 |
| 実装計画策定 | ✅ 完了 | 2025-09-22 |
| プロジェクト作成 | ⏳ 開始前 | - |
| ロジック移植 | ⏳ 開始前 | - |
| UI実装 | ⏳ 開始前 | - |
| PDF機能実装 | ⏳ 開始前 | - |

---

## 📝 メモ・備考

### 技術的決定事項
- jsPDF + html2canvasを使用（SVG→Canvas→PDF変換）
- TypeScriptの厳密モードを維持
- 既存の九星計算ロジックをそのまま活用

### 将来の拡張可能性
- Word形式の出力（docx.js使用）
- 時刻盤の追加（18時間周期の実装）
- API化によるマイクロサービス化
- 複数ユーザーの鑑定書管理機能

### クライアント向け説明ポイント
- 「既存の正確な計算ロジックを100%活用」
- 「軽量で高速なシステム」
- 「編集機能により柔軟なカスタマイズが可能」
- 「将来的な機能拡張も容易」

---

## 1. 基本情報

- **ステータス**: 実装準備段階
- **完了タスク数**: 2/8
- **進捗率**: 25%
- **次のマイルストーン**: プロジェクト基盤構築
- **最終更新日**: 2025-09-22

## 2. 実装計画

BlueLampでの開発は以下のフローに沿って進行します：

### 開発フェーズ
| フェーズ | 状態 | 担当エージェント | 解説 |
|---------|------|----------------|------|
| **Phase 1: 要件定義** | [ ] | 要件定義エンジニア | あなたのアイデアを実現可能な要件に落とし込みます |
| **Phase 2: Git/GitHub管理** | [ ] | Git管理エージェント | プロジェクトリポジトリを準備し開発環境を整えます |
| **Phase 3: フロントエンド基盤** | [ ] | フロントエンド基盤オーケストレーター | React+TypeScript+Viteの最新基盤が即座に立ち上がります |
| **Phase 4: ページ実装** | [ ] | ページ実装オーケストレーター | 画面が一つずつ形になっていきます |
| **Phase 5: 環境構築** | [ ] | 環境構築オーケストレーター | 本番環境で動作するための秘密鍵を取得し設定します |
| **Phase 6: バックエンド計画** | [ ] | バックエンド計画オーケストレーター | 実装の順番を計画し効果的にプロジェクトを組み上げます |
| **Phase 7: バックエンド実装** | [ ] | バックエンド実装オーケストレーター | いよいよバックエンドの実装に入ります |
| **Phase 8: API統合** | [ ] | フロントエンド実装オーケストレーター | プロトタイプが動くシステムへと変わります |
| **Phase 9: E2Eテスト** | [ ] | E2Eテストオーケストレーター | ユーザー操作をシミュレートして品質を担保します |
| **Phase 10: デプロイメント** | [ ] | デプロイオーケストレーター | いよいよデプロイ！インターネットに公開します |

### サポートツール（必要に応じて使用）
| ツール | 担当エージェント | 解説 |
|---------|----------------|------|
| **機能拡張** | 機能拡張オーケストレーター | リリース後も新機能を追加できます |
| **デバッグ** | デバッグマスター | エラーが発生したら完全自動で解決します |
| **TypeScript型解消** | TypeScript型解消オーケストレーター | 型エラーを徹底的に分析し一掃します |
| **リファクタリング** | リファクタリングオーケストレーター | コード品質を大規模に改善します |
| **ドキュメント生成** | ドキュメント生成オーケストレーター | 日本標準の納品ドキュメントを自動生成します |
| **相談** | 相談エージェント | プロジェクトに関する汎用的な相談やサポートを提供します |


## 4. 付録

### 開発フロー
```
Phase 1: 要件定義 → Phase 2: Git管理 → Phase 3: フロントエンド基盤 → Phase 4: ページ実装
→ Phase 5: 環境構築 → Phase 6: バックエンド計画 → Phase 7: バックエンド実装
→ Phase 8: API統合 → Phase 9: E2Eテスト → Phase 10: デプロイメント

※ サポートツールは必要に応じて適宜使用
```

### 開始手順

開発プロンプトをクリックして「Phase 1: 要件定義」を選択し、要件定義エンジニアを活用するところから始めてください。各フェーズが完了したら、次のPhaseへ進みます。

サポートツールは開発中の任意のタイミングで、問題解決や品質向上のために使用できます。
